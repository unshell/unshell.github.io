function hideOtherDocument(){document.body.querySelectorAll("*").forEach(e=>{var o=window.getComputedStyle(e).display||"";"none"!==o&&(e.setAttribute("fish-ads-original-display",o),e.style.display="none")})}function toggleFullScreen(){var e=document.body.querySelector([".webfullscreenBtn i",'[aria-label="网页全屏"]',".xgplayer-page-full-screen .xgplayer-icon",".player-buttons_videofullBtn__\\+Euuz"].join(","));if(e&&e.click)throw e.click(),new Error("已存在网页全屏功能");document.body.querySelector("."+classNameFA)&&(document.body.querySelector("."+classNameFA).remove(),document.body.querySelectorAll("[fish-ads-original-display]").forEach(e=>{var o=e.getAttribute("fish-ads-original-display");"none"!==o&&(e.removeAttribute("fish-ads-original-display"),e.style.display=o)}),document.body.style.height="auto",document.body.style.overflow="visible")}function topVideo(){console.log("Fish-Ads-Event-TopVideo"),toggleFullScreen();var e=findValidVideo(),o="iframe",t=findValidVideo(o);if(!e)throw"pan.baidu.com"===location.host&&(t=!1,setTimeout(topVideo,500)),t&&(hideOtherDocument(),handleInsert(o)),new Error("网页未找到 video 元素");if(hideOtherDocument(),e.paused){var i=document.createElement("span");i.className="fish-ads-tips",i.display="inline-block",i.style.color="#fff",i.innerHTML="请稍等，正在加载...<br>出现该提示可能意味着存在广告，且主视频先被抓取到了<br>如果广告结束还没播放主视频，可以尝试点击“开启桌面屏保”",i.zIndex="1998",document.body.insertBefore(i,document.body.firstChild),document.body.style.height="100vh !important",document.body.style.overflow="hidden"}e.muted=!1,e.volume=1,e.addEventListener("timeupdate",handleCanplay,{once:!0})}function handleCanplay(){console.log("Fish-Ads-Event-HandleCanplay");var e=findValidVideo();if(!e)throw new Error("网页未找到 video 元素");if(e.removeEventListener("timeupdate",handleCanplay),document.body.querySelector(".fish-ads-tips")&&document.body.querySelector(".fish-ads-tips").remove(),handleInsert(),!isFinite(this.duration))throw new Error("直播流无法获取长度");console.log("Fish-Ads-HandleCanplay-Duration",this.duration),console.log("Fish-Ads-HandleCanplay-CurrentTime",e.currentTime),setTimeout(topVideo,1e3*(this.duration-e.currentTime))}function handleInsert(e){console.log("Fish-Ads-Event-HandleInsert"),document.body.querySelector("."+classNameFA)&&document.body.querySelector("."+classNameFA).remove();var o=document.createElement("div"),t=findValidVideo(e);if(!t)throw new Error("网页未找到 video 元素");o.className=classNameFA,t.style.height="100%",t.style.width="100%",o.appendChild(t),document.body.insertBefore(o,document.body.firstChild),"iframe"!=e&&(t.currentTime=t.currentTime,t.paused||t.play()),document.body.style.height="100vh !important",document.body.style.overflow="hidden",t.style.display="block",t.style.position="fixed",t.style.height="100%",t.style.width="100%",t.style.visibility="visible",t.style.objectFit="contain",t.style.zIndex="1997"}function findValidVideo(e){const o=document.body.querySelectorAll(e||"video");if(console.log("allVideos",o),o.length>0){const e=Array.from(o).filter(e=>{const o=e.getAttribute("src");return"IFRAME"!==e.tagName&&"VIDEO"!==e.tagName||("pan.baidu.com"===location.host?"vjs_video_3_html5_api"!==e.id:o&&""!==o.trim()&&!o.toLowerCase().includes("unknown"))});if(console.log("validVideos",e),e.length>0)return e[0]}}function handleSpecialWebsite(){if("www.douyin.com"===location.host){var e=function(){let o=findValidVideo(),t=[".xgplayer-listen-video",".xgplayer-picture-in-picture-setting",".xgplayer-fullscreen"];o.onpause=e,setTimeout(()=>{document.body.querySelectorAll(t.join(",")).forEach(e=>e.remove())},500)};document.body.querySelectorAll(".fullscreen_capture_feedback").forEach(e=>e.style.removeProperty("min-height")),e()}else"www.iqiyi.com"===location.host&&(document.body.querySelector(".xplayer_root__HlX4a").style.minWidth="auto",document.body.querySelector(".XPlayer_root__eWzab").style.minWidth="auto",document.body.querySelector(".iqp-player.use-pc-bridge").style.minWidth="auto",document.body.querySelector("#outlayer").style.minWidth="auto")}var classNameFA="fish-ads-video-wrapper";console.clear(),console.log("!!!摸鱼弹层窗口全屏脚本已注入!!!");